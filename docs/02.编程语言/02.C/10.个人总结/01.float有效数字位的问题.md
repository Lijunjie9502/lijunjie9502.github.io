---
author: 
  name: 木子识时务
  link: https://github.com/sbwcwso
editLink: true
title: float有效数字位的问题
date: 2021-08-14 18:24:47
permalink: /pages/308d6b/
categories: 
  - null
tags: 
  - null
---

# `float` 有效数字位的问题

::: warning 想要搞清楚问题，还是要先搞明白相关的概念
[wiki: 有效数字](https://en.wikipedia.org/wiki/Significant_figures)
[wiki: Floating-point_arithmetic](https://en.wikipedia.org/wiki/Floating-point_arithmetic)
:::


## `float.h` 中的计算公式是怎么来的

* C 在 `float.h` 中定义了 `FLT_DIG` 来表示 `float` 的有效数字位，另外还有 `DBL_DIG` 和 `LDBL_DIG` 分别表示 `double` 和 `long double` 的有效数字位数， 其中的注释具体如下：

> Number of decimal digits, q, such that any floating-point number with q  
> decimal digits can be rounded into a floating-point number with p radix b  
> digits and back again without change to the q decimal digits,  
>  ```c
>  /* Number of decimal digits, q, such that any floating-point number with q
>    decimal digits can be rounded into a floating-point number with p radix b
>    digits and back again without change to the q decimal digits,
>
>    p * log10(b)			if b is a power of 10
>    floor((p - 1) * log10(b))	otherwise
>  */
>  ```
>  
> [gcc float.h](https://sites.uclouvain.be/SystInfo/usr/include/float.h.html)

:::details 可以用下面的程序来查看各个变量对应的值
* `Ubuntu 20.04.3` 下 `gcc 9.3.0` 和 `clang 12.0.0` 的输出是相同的，可以看到 `float` 输出的有效数字位数是 `6`，而不是有些地方说的 `7`。下面也会说明为何是 `6`，而不是 `7`

* 代码

<<< docs/02.编程语言/02.C/10.个人总结/code/01.1.c#code

* 输出

<<< docs/02.编程语言/02.C/10.个人总结/code/01.1.c#output
:::

:::note 个人理解
* 具体就是十进制下有效数字位 `q` 的计算公式如下：
  * $$q = \lfloor (p-1)log10(b) \rfloor$$
    * `b` 为相应的基底
      * 对于二进制，`b = 2`
    * `p` 为尾数对应的位数
:::

<tbody><tr>
<th>Type
</th>
<th>Sign
</th>
<th>Exponent
</th>
<th>Significand field
</th>
<th>Total bits
</th>
<th>
</th>
<th>Exponent bias
</th>
<th>Bits precision
</th>
<th>Number of decimal digits
</th></tr>
<tr>
<td>Half(IEEE 754-2008)
</td>
<td>1
</td>
<td>5
</td>
<td>10
</td>
<td>16
</td>
<td>
</td>
<td>15
</td>
<td>11
</td>
<td>~3.3
</td></tr>
<tr>
<td>Single
</td>
<td>1
</td>
<td>8
</td>
<td>23
</td>
<td>32
</td>
<td>
</td>
<td>127
</td>
<td>24
</td>
<td>~7.2
</td></tr>
<tr>
<td>Double
</td>
<td>1
</td>
<td>11
</td>
<td>52
</td>
<td>64
</td>
<td>
</td>
<td>1023
</td>
<td>53
</td>
<td>~15.9
</td></tr>
<tr>
<td>x86 extended precision
</td>
<td>1
</td>
<td>15
</td>
<td>64
</td>
<td>80
</td>
<td>
</td>
<td>16383
</td>
<td>64
</td>
<td>~19.2
</td></tr>
<tr>
<td>Quad
</td>
<td>1
</td>
<td>15
</td>
<td>112
</td>
<td>128
</td>
<td>
</td>
<td>16383
</td>
<td>113
</td>
<td>~34.0
</td></tr></tbody>
