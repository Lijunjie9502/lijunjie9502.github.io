---
author: 
  name: 木子识时务
  link: https://github.com/sbwcwso
editLink: true
title: 第 5 章 操作符和表达式
date: 2021-08-18 19:31:56
permalink: /pages/6183ad/
categories: 
  - 
tags: 
  - 
---

# 操作符和表达式

:::note 主要内容
* C 提供了所有你希望编程语言应该拥有的操作符
  * 它甚至提供了一些你意想不到的操作符
  * 事实上， C 被许多人所诉病的一个缺点就是它品种繁多的操作符
    * C 的这个特点使它很难精通
  * 但另一方面， C 的许多操作符具有其他语言的操作符无可抗衡的价值
    * 这也是 C 适用千开发范围极广的应用程序的原因之一

* 在介绍完操作符之后，将讨论表达式求值的规则，包括操作符优先级和算术转换。
:::

::: details 书本内容
![5-0-2021-08-20-00-02-57](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-0-2021-08-20-00-02-57.png)
:::

<!-- more -->

```markmap
- [操作符和表达式](#操作符和表达式)
  - [操作符](#操作符)
    - [算术操作符](#算术操作符)
    - [移位操作符](#移位操作符)
    - [位操作符](#位操作符)
    - [赋值](#赋值)
    - [单目操作符](#单目操作符)
    - [关系操作符](#关系操作符)
    - [逻辑操作符](#逻辑操作符)
    - [条件操作符](#条件操作符)
    - [逗号操作符](#逗号操作符)
    - [下标引用, 函数调用和结构成员](#下标引用-函数调用和结构成员)
  - [布尔值](#布尔值)
  - [表达式求值](#表达式求值)
    - [隐式类型转换](#隐式类型转换)
    - [算术转换](#算术转换)
    - [操作符的属性 -- 优先级及结合性](#操作符的属性----优先级及结合性)
    - [优先级和求值的顺序](#优先级和求值的顺序)
  - [总结](#总结)
  - [问题](#问题)
  - [编程总结](#编程总结)
```

## 操作符

::: details 书本内容
![5-1-2021-08-20-00-02-32](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-2021-08-20-00-02-32.png)
:::


### 算术操作符

::: details 书本内容
![5-1-1-2021-08-20-02-10-09](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-1-2021-08-20-02-10-09.png)
:::

### 移位操作符

::: details 书本内容
![5-1-2-2021-08-20-02-10-33](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-2-2021-08-20-02-10-33.png)
:::

### 位操作符

::: details 书本内容
![5-1-3-2021-08-20-02-10-45](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-3-2021-08-20-02-10-45.png)
:::


### 赋值

::: details 书本内容
![5-1-4-2021-08-20-02-11-56](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-4-2021-08-20-02-11-56.png)
:::

::: tip EOF
* `EOF` 在 `stdio.h` 中按如下语句定义，其字面值的默认类型为 `int`

  ```c
  #define EOF (-1)
  ```

* [在终端中输入 EOF](https://stackoverflow.com/a/1782134/11152760)
  * Linux 下为 `Ctrl + D`, Windows 下为 `Ctrl + Z`
  * 可能要输入 `Enter` 才会生效

* `getchar()` 的返回值为 `int`
  * 当其读入 `EOF` 后，返回值为 `-1`
  * 如果 `int` 有 32 位，则 `-1` 的十六进制为 `0xFFFF FFFF`
* 对于下列语句
  
  ```c
  char ch;
  ...
  while ((ch = getchar()) != EOF)...
  ```

  * `char` 用八位二进制储存
  * 当 `char` 为 `signed char` 时，当读入字符 `\377(0xFF)` 时，`ch=0xFF`
    * 其与 `EOF` 进行比较时，`ch` 会被提升为 `int`，有符号的提升会保留符号位的 `1`， 因此 `0xFF` 会被提升为 `0x FFFF FFFF`
    * 此时满足判断条件，与程序的本意不符
  * 当 `char` 为 `unsigned char` 时， 当读入 `EOF` 时， `getchar()` 返回 `0xFFFF FFFF(-1)`，其会被截短为 `0xFF`， `ch=0xFF`
    * 当与 `EOF(-1)` 进行比较时， `ch` 被提升为 `int`， 无符号提升时直接在左边添0， 结果为 `0x0000 00FF`，其不与 `EOF` 相同，结果就是造成死循环
:::

### 单目操作符

::: details 书本内容
![5-1-5-2021-08-20-02-21-31](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-5-2021-08-20-02-21-31.png)
:::

### 关系操作符

::: details 书本内容
![5-1-6-2021-08-20-02-21-51](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-6-2021-08-20-02-21-51.png)
:::

### 逻辑操作符

::: details 书本内容
![5-1-7-2021-08-20-02-22-29](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-7-2021-08-20-02-22-29.png)
:::

### 条件操作符

::: details 书本内容
![5-1-8-2021-08-20-02-22-51](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-8-2021-08-20-02-22-51.png)
:::

### 逗号操作符

::: details 书本内容
![5-1-9-2021-08-20-02-31-16](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-9-2021-08-20-02-31-16.png)
:::

### 下标引用, 函数调用和结构成员

::: details 书本内容
![5-1-10-2021-08-20-02-31-46](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-1-10-2021-08-20-02-31-46.png)
:::

## 布尔值

::: details 书本内容
![5-2-2021-08-20-02-32-08](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-2-2021-08-20-02-32-08.png)
:::

## 表达式求值

::: details 书本内容
![5-4-2021-08-20-02-32-55](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-4-2021-08-20-02-32-55.png)
:::

### 隐式类型转换

::: details 书本内容
![5-4-1-2021-08-20-02-33-22](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-4-1-2021-08-20-02-33-22.png)
:::

### 算术转换

::: details 书本内容
![5-4-1-2021-08-20-02-33-37](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-4-1-2021-08-20-02-33-37.png)
:::

### 操作符的属性 -- 优先级及结合性

::: details 书本内容
![5-4-3-2021-08-20-02-33-59](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-4-3-2021-08-20-02-33-59.png)
:::

:::tip 按操作符类别大致的划分优先级
聚组 >  
函数调用 > 下标引用 > 结构成员访问 >  
单目操作符 >  
算术操作符 > 移位操作符 >  
关系操作符 > 位操作符 > 逻辑操作符 > 条件操作符 >  
赋值操作符 >  
逗号操作符
:::

### 优先级和求值的顺序

::: details 书本内容
![5-4-4-2021-08-20-02-36-27](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-4-4-2021-08-20-02-36-27.png)
:::

## 总结

::: details 书本内容
![5-5-2021-08-20-02-36-45](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/5-5-2021-08-20-02-36-45.png)
:::

## 问题

<h4 id='q1'></h4>

1. 下面这个表达式的类型和值分别是什么？

```c
(float)(25/10)
```

::: details 答案
* 类型为 `float`
* 值为 `2.0`
:::

<h4 id='q2'></h4>

2. 下面这个程序的结果是什么？

```c
int
func( void )
{
  static int counter = 1;

  return ++counter;
}

int
main()
{
  int answer;
  answer = func() - func() * func();
  printf( "%d\n", answer );
}
```


::: details 答案
* clang-12 和 gcc 9.3.0 输出的结果均为 `-10`

* 但最后的结果却因编辑器而异，因为标准只规定了乘法运算必须在加法运算前完成，但并没有规定函数调用的顺序，因此，以下几种结果，都是合法的
:::tip 合法结果

```bash
-10   ( 2 - 3 * 4 or 2 - 4 * 3)
-5    ( 3 - 2 * 4 or 3 - 4 * 2)
-2    ( 4 - 2 * 3 or 4 - 2 * 3)
```

:::

<h4 id='q3'></h4>

3. 你认为位操作符和移位操作符可以用在什么地方？

::: details 答案
* 主要用于修改或测试特定的位
  * 具体参照 [位的操纵](#位操作符)
:::

<h4 id='q4'></h4>

4. 条件操作符在运行时较之if语句是更快还是更慢？试比较下面两个代码段。

```c
if( a > 3 )
  i = b + 1;
else
  i = c * 5;
```

```c
i = a > 3 ? b + 1 : c *5;
```

::: details 答案
* 两者在速度上并无区别，因为其执行的过程是一致的
:::

<h4 id='q5'></h4>

5. 可以被 `4` 整除的年份是闰年，但是其中能够被 `100` 整除的年份又不是闰年。但是，这其中能够被 `400` 整除的年份又是闰年。请用一条赋值语句，如果变量 `year` 的值是闰年，把变量 `leap_year` 设置为真。如果 `year` 的值不是闰年，把 `leap_year` 设置为假

::: details 答案

```c
leap_year = year % 400 == 0 ||
            year % 4 == 0 && year % 100 != 0
```

:::tip
* `&&` 的优先级比 `||` 高
:::

<h4 id='q6'></h4>

6. 哪些操作符具有副作用？它们具有什么副作用？

::: details 答案
* 函数调用 `()`
  * 可能会产生副作用
* 单目运算符中的 `++` 和 `--`
  * 其前缀和后缀形式均会修改操作数的值
* 赋值运算符
  * 包括 `=` 和所有的复合赋值符
  * 其会修改作为左值的操作数的值
:::

<h4 id='q7'></h4>

7. 下面这个代码段的结果是什么？

```c
int a = 20;
...
if( 1 <= a <= 10 )
  printf( "In range\n" );
else
  printf( "Out of range\n" );
```

::: details 答案
* 会输出 `In range`
* 因为 `<=` 为关系操作符，其结合性是从左至右的
  * 当 `a = 20` 时，`1 <= 20` 的结果是 `1`， 然后 `1 <= 10` 的结果也是 `1`， 即 `1 <= 20 <=10` 的结果为 `1`， 为 `true`
* `1 <= a <= 10` 是合法语句，但是却不能像预期的那样的工作

:::tip 在 Python 中按照这种写法，可以达至预期的结果

```python
a = 20
if 1 <= a <= 10:
  print("In range\n");
else:
  print("Out of range\n")
```

* 其会输出 `Out of range.`
:::

## 编程总结
