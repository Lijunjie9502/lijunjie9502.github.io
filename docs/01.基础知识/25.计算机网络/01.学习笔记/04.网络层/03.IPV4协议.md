---
author: 
  name: 木子识时务
  link: https://github.com/sbwcwso
editLink: true
title: IPV4 协议
date: 2021-09-07 09:19:01
permalink: /pages/fe1e56/
categories: 
  - 计算机网络
tags: 
  - 
---


# IPV4 协议

```markmap
- [IPV4 协议](#ipv4-协议)
  - [IP 数据报](#ip-数据报)
  - [IP 分片](#ip-分片)
    - [最大传输单元(MTU)](#最大传输单元mtu)
```

* 主机、路由器网络层的主要功能
  * ![20210907092048-2021-09-07-09-20-48](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210907092048-2021-09-07-09-20-48.png)

  * ICMP 协议一定程度上可以看做是 IP 协议的伴随协议

## IP 数据报

* IP 数据报的格式
  * ![20210907092414-2021-09-07-09-24-14](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210907092414-2021-09-07-09-24-14.png)

* 版本号
* 首部长度
  * 以 4 个字节为单位
* 服务类型(TOS): 指示期望获得哪种类型的服务
  * 1998 年这个字段改名为区分服务
  * 只有在网络提供区分服务(DiffServ)时这个字段才有效
* 一般情况下不使用，通常IP分组的该字段(第2字节)的值为00H
* 总长度: IP分组的总字节数(首部+数据)
  * 最大IP分组的总长度：65535B
  * 最小的IP分组首部：20B
  * IP分组可以封装的最大数据：65535-20=65515B
* 生存时间(TTL) 字段占8位：IP分组在网络中可以通过的路由器数（或跳步数）
  * 路由器转发一次分组，TTL 减 1
  * 如果 TTL=0，路由器则丢弃该 IP 分组
    * 路由器丢弃分组后会向源主机发送 ICMP 报文
* 协议: 指示IP分组封装的是哪个协议的数据包
  * 实现复用/分用
  * 6为TCP，表示封装的为TCP段；17为UDP，表示封装的是UDP数据报
* 首部校验和：
  * 计算校验和时，该字段置全0
  * 采用反码算数运算求和，和的反码作为首部校验和字段
  * 逐跳计算、逐跳校验
* 源IP地址、目的IP地址字段各占32位
  * 分别标识发送分组的源主机/路由器(网络接口)和接收分组的目的主机/路由器（网络接口）的IP地址

* 选项字段占长度可变，范围在1~40B之间：携带安全、源选路径、时间戳和路由记录等内容
  * 实际上很少被使用

* 填充字段占长度可变，范围在0~3B之间：
  * 目的是补齐整个首部，符合32位对齐
  * 即保证首部长度是4字节的倍数

## IP 分片

### 最大传输单元(MTU)


