---
author: 
  name: 木子识时务
  link: https://github.com/sbwcwso
editLink: true
title: 可靠数据传输的基本原理
date: 2021-08-30 09:36:20
permalink: /pages/447ce5/
categories: 
  - 计算机网络
tags: 
  - 
---

# 可靠数据传输的基本原理

::: tip 什么是可靠？
* 不错
* 不丢
* 不乱
:::

:::note 可靠数据传输依靠可靠数据传输协议(rdt)
* 可靠数据传输对应用层、传输层、链路层都很重要
* 网络 Top-10 问题
* 信道的不可靠特性决定了可靠数据传输协议的复杂性
:::

<!-- more -->

```markmap
- [可靠数据传输的基本原理](#可靠数据传输的基本原理)
  - [可靠数据传输协议](#可靠数据传输协议)
  - [Rdt1.0: 可靠信道上的可靠数据传输协议](#rdt10-可靠信道上的可靠数据传输协议)
  - [Rdt2.0](#rdt20)
    - [Rdt2.0: 产生位错误的信道](#rdt20-产生位错误的信道)
    - [Rdt2.0: FSM规约](#rdt20-fsm规约)
  - [Rdt2.1](#rdt21)
```

## 可靠数据传输协议

* 从服务提供者的角度来看
  * 单向调用可靠数据传输协议即可
* 从服务实现的角度来看
  * 在不可靠的信道上实现可靠的数据传输
    * 需要双向控制数据的流动

:::note 可靠数据传输协议基本结构:接口
:::details 示意图
![20210830095527-2021-08-30-09-55-27](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830095527-2021-08-30-09-55-27.png)
:::

:::note 后续研究过程
* 渐进地设计可靠数据传输协议的发送方和接收方
* 只考虑单向数据传输
  * 但控制信息双向流动
* 利用有限状态机(Finite State Machine, FSM)刻画传输协议
  :::details 状态机示意图
    ![20210830100119-2021-08-30-10-01-19](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830100119-2021-08-30-10-01-19.png)
    * `event` 事件
    * `action` 采取的行动
:::

## Rdt1.0: 可靠信道上的可靠数据传输协议

:::note 底层信道完全可靠
* 不会发生错误(bit error)
* 不会丢弃分组
:::

:::tip 发送方和接收方的FSM独立
  :::details 状态机示意图
  ![20210830100407-2021-08-30-10-04-07](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830100407-2021-08-30-10-04-07.png)
  * `sender`
    * `rdt_send`
      * 应用层调用，传送 `data`
    * `make_pkt`
      * 创建分组
    * `udt_send`
      * 发送分组
  * `receiver`
    * `deliver_data`
      * 向应用层传送 `data`
:::

## Rdt2.0

### Rdt2.0: 产生位错误的信道

:::tip 底层信道可能翻转分组中的位(bit)
* 可以利用**校验和**检测位错误
:::

:::note 如何从错误中恢复过来
* **确认机制(Acknowledgements,ACK)**
  * 接收方显式地告知发送方分组已正确接收
* **NAK**
  * 接收方显式地告知发送方分组有错误
* 发送方收到 NAK 后，**重传**分组
:::

::: warning 基于这种重传机制的 rdt 协议称为 <mark class='c3'>ARQ</mark>(Automatic Repeat reQuest) 协议
:::

::: tip Rdt2.0 中引入的新机制
* 差错检测
* 接收方反馈控制消息: ACK/NAK
* 重传
:::

### Rdt2.0: FSM规约

:::tip 停--等协议
:::

:::note sender
:::details 示意图
![20210830102134-2021-08-30-10-21-34](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830102134-2021-08-30-10-21-34.png)
* 需要对分组进行缓存
:::

:::note receiver
:::details 示意图
![20210830102344-2021-08-30-10-23-44](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830102344-2021-08-30-10-23-44.png)
:::

:::note Rdt2.0 无错误场景
:::details 示意图
![20210830102734-2021-08-30-10-27-34](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830102734-2021-08-30-10-27-34.png)
:::

::: note Rdt 2.0: 有错误场景
:::details 示意图
![20210830102806-2021-08-30-10-28-07](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830102806-2021-08-30-10-28-07.png)
:::

## Rdt2.1

::: warning Rdt2.0 的缺陷: ACK/NAK 消息发生错误/被破坏(corrupted)
* 解决方案
  * 为 ACK/NAK 增加校验和，检错并纠错
    * 纠错的难度高，有代价
  * 发送方收到被破坏 ACK/NAK 时不知道接收方发生了什么，添加额外的控制消息
    * 不能从根本上解决问题，因为额外的控制消息也可能发生错误
  * 如果 ACK/NAK 坏掉，发送方重传
    * 但是简单的重传会产生**重复分组**
      * 如前一次传送成功，但 `ACK` 发送错误
:::

::: tip 解决重复分组的方案
* 序列号(Sequence number):
  * 发送方给每个分组增加序列号
* 接收方丢弃重复分组
:::
