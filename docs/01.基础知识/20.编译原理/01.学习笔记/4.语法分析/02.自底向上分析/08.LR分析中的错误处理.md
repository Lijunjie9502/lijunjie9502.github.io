---
author: 
  name: 木子识时务
  link: https://github.com/sbwcwso
editLink: true
title: LR分析中的错误处理
date: 2021-08-19 02:30:52
permalink: /pages/fff948/
categories: 
  - 编译原理
tags: 
  - 
---

# LR分析中的错误处理


```markmap
- [LR分析中的错误处理](#lr分析中的错误处理)
  - [LR 分析中的错误检测](#lr-分析中的错误检测)
  - [恐慌模式错误恢复](#恐慌模式错误恢复)
  - [短语层次错误恢复](#短语层次错误恢复)
```

## LR 分析中的错误检测

::: note 语法错误的检测
* 当 LR 分析器在查询分析表并发现一个报错条目时，就表示检测到了一个语法错误
  * 即表示当前已扫描的输入部分不可能存在正确的后续符号串,此时 LR 分析器会立刻报错
  * 规范的 LR 语法分析器不会做任何多余的归约动作，会立即报告错误
  * SLR 和 LALR 语法分析器，可能会在报错之前执行几次归约动作
    * 但它们绝不会把一个错误的输入符号移入到栈中
    > * [合并同心项集可能会推迟错误的发现](/pages/f0c5a5/#合并同心项集可能会推迟错误的发现)
:::

:::tip 错误恢复策略
* 恐慌模式错误恢复
* 短语层次错误恢复
:::

## 恐慌模式错误恢复

:::note 恐慌模式错误恢复策略的实现
* 从栈顶向下扫描，直到发现某个状态 $s_i$
  * 它有一个对应于某个非终结符 $A$ 的 $GOTO$目标
  * 可以认为从这个 $A$ 推导出的串中包含错误
* 然后丢弃 $0$ 个或多个输入符号，直到发现一个可能合法地跟在 $A$ 之后的符号 $a$ 为止
* 之后将 $s_{i+1} = GOTO(s_i , A)$ 压入栈中，继续进行正常的语法分析
:::

::: tip 基本原理
* 恐慌模式错误恢复试图消除包含语法错误的短语
* 语法分析器假定一个从 $A$ 推导出的串中包含错误
  * 这个串的一部分已被处理，并形成了栈顶部的一个状态序列
  * 这个串的其余部分还在输入中
    * 语法分析器在输入中查找可以合法的跟在 $A$ 后面的符号
      * 从而试图跳过这个串的其余部分
* 通过从栈中删除状态，跳过一部分输入，并将 $GOTO(s, A)$ 压入栈中
  * 语法分析器假装其已经找到了 $A$ 的一个实例
  * 并继续进行正常的语法分析
:::

## 短语层次错误恢复

::: note 短语层次错误恢复的基本原理
* 检查LR分析表中的每一个报错条目，并根据语言的使用方法来决定程序员所犯的何种错误最有可能引起这个语法错误
* 然后构造出适当的恢复过程
  :::tip 通常会根据各个报错条目来确定适当的方法
  * 修改栈顶状态和/或第一个输入符号
:::

::: details 带有错误处理子程序的算术表达式文法
* > 原[算术表达式文法的 LR 分析](/pages/25b463/#二义性算术表达式文法的-lr-分析)
* 算术表达式文法的 LR(0) 状态机
  * ![20210827194033-2021-08-27-19-40-33](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210827194033-2021-08-27-19-40-33.png)
* 带有错误处理子程序的算术表达式文法 LR 分析表
  * ![20210830170055-2021-08-30-17-00-56](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830170055-2021-08-30-17-00-56.png)
  * 对于那些在某些输入上执行特定规约动作的状态
    * 将这个状态中的报错条目替换为这个规约动作
    * 此操作可能会使得报错延后至一次或多次规约动作之后
      * 但是错误仍然会在任何移入动作发生之前被发现
* 错误处理的例程如下:
  * **$e_1$**：在状态 0，2，4，5 上被调用
    * 所有这些状态都期望读入一个运算分量的第一个符号
      * 这个符号可能是 $id$ 或 $($，但是实际读入的却是 $+$、$*$ 或 $\textdollar$
    * 对应的操作
      * 将状态3（状态 0、2、4和 5 在输入 id 上的 GOTO 目标）压入栈中
      * 发出诊断信息"缺少运算分量"
  * **$e_2$**：在状态 0、1、2、4 和 5 上发现输入为 $)$ 时调用这个过程
    * 对应的操作
      * 从输入中删除 $)$
      * 发出诊断信息"不匹配的右括号"
  * **$e_3$**：当在状态 1 和 6 上，期待读入一个运算符却发现了一个 $id$ 或 $($ 时调用
    * 对应的操作
      * 将状态 4 （对应于符号 $+$ 的状态）压入栈中
      * 发出诊断信息"缺少运算符"
  * **$e_4$**：当在状态 6 上发现 $\textdollar$ 时调用
    * 对应的操作
      * 将状态 9 （对应于 $)$ ）压入栈中；
      * 发出诊断信息"缺少右括号"
* 示例：处理错误输入 $id + )$ 的过程
  * ![20210830172323-2021-08-30-17-23-23](https://cdn.jsdelivr.net/gh/sbwcwso/PicBed@master/20210830172323-2021-08-30-17-23-23.png)
:::

